<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Floating Reaction Panel Demo (Persistent)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 40px;
      background: #f3f4f6;
      color: #111827;
      line-height: 1.6;
    }

    .content {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      margin-top: 0;
      color: #0f172a;
    }

    p {
      margin-bottom: 1rem;
    }

    /* Floating reaction panel */
    .reaction-floating {
      position: fixed;
      top: 50%;
      right: 16px;
      transform: translateY(-50%);
      width: 190px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.7);
      padding: 14px 12px 10px;
      z-index: 999;
      font-size: 0.85rem;
    }

    .reaction-floating-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .reaction-floating-header h3 {
      margin: 0;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .reaction-floating-header span.icon {
      font-size: 1.1rem;
    }

    .reaction-floating small {
      color: #9ca3af;
      font-size: 0.7rem;
    }

    .reaction-buttons {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .reaction-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 999px;
      padding: 4px 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.7);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
    }

    .reaction-button:hover {
      background: rgba(30, 64, 175, 0.8);
      box-shadow: 0 0 0 1px rgba(191, 219, 254, 0.3);
      transform: translateY(-1px);
    }

    .reaction-button.active {
      background: rgba(22, 163, 74, 0.25);
      border-color: rgba(34, 197, 94, 0.8);
    }

    .reaction-button.bump {
      transform: scale(1.05);
      box-shadow: 0 0 0 1px rgba(74, 222, 128, 0.7);
    }

    .reaction-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .reaction-emoji {
      font-size: 1.1rem;
    }

    .reaction-label {
      color: #e5e7eb;
      font-size: 0.8rem;
    }

    .reaction-count {
      font-size: 0.8rem;
      color: #9ca3af;
      min-width: 2ch;
      text-align: right;
    }

    /* Mobile: move panel to bottom */
    @media (max-width: 800px) {
      .reaction-floating {
        top: auto;
        bottom: 10px;
        left: 10px;
        right: 10px;
        transform: none;
        width: auto;
        display: flex;
        flex-direction: column;
      }
      .reaction-buttons {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .reaction-button {
        flex: 1 1 45%;
      }
    }
  </style>
</head>
<body>
  <div class="content">
    <h1>My Robot Design Page</h1>
    <p>
      Imagine your mechanical analysis, linkage math, MATLAB graphs, etc.
      The floating reaction panel on the right is global ‚Äî not tied to sections.
    </p>
    <p>
      Click a reaction once to add it (count = 1). Click again to remove it (count = 0).
      The state is saved in your browser, so it stays even after refresh.
    </p>
  </div>

  <!-- Floating reaction panel -->
  <aside class="reaction-floating">
    <div class="reaction-floating-header">
      <h3><span class="icon">‚ú®</span> Reactions</h3>
    </div>
    <small>How do you feel about this page?</small>
    <div class="reaction-buttons">
      <button class="reaction-button" data-emoji="üëç" data-label="Helpful">
        <div class="reaction-left">
          <span class="reaction-emoji">üëç</span>
          <span class="reaction-label">Helpful</span>
        </div>
        <span class="reaction-count">0</span>
      </button>

      <button class="reaction-button" data-emoji="ü§Ø" data-label="Mind-blown">
        <div class="reaction-left">
          <span class="reaction-emoji">ü§Ø</span>
          <span class="reaction-label">Mind-blown</span>
        </div>
        <span class="reaction-count">0</span>
      </button>

      <button class="reaction-button" data-emoji="‚ù§Ô∏è" data-label="Love it">
        <div class="reaction-left">
          <span class="reaction-emoji">‚ù§Ô∏è</span>
          <span class="reaction-label">Love it</span>
        </div>
        <span class="reaction-count">0</span>
      </button>

      <button class="reaction-button" data-emoji="üî•" data-label="So cool">
        <div class="reaction-left">
          <span class="reaction-emoji">üî•</span>
          <span class="reaction-label">So cool</span>
        </div>
        <span class="reaction-count">0</span>
      </button>
    </div>
  </aside>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const STORAGE_KEY = 'floatingReactions_v1';

      // Load saved state from localStorage
      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : {};
        } catch (e) {
          console.warn('Failed to parse reaction state:', e);
          return {};
        }
      }

      // Save state to localStorage
      function saveState(state) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
          console.warn('Failed to save reaction state:', e);
        }
      }

      const state = loadState(); // { "üëç": true/false, "ü§Ø": true/false, ... }
      const buttons = document.querySelectorAll('.reaction-button');

      // Initialise UI from saved state
      buttons.forEach(btn => {
        const emoji = btn.dataset.emoji;
        const countSpan = btn.querySelector('.reaction-count');
        const isActive = !!state[emoji];

        if (isActive) {
          btn.classList.add('active');
          countSpan.textContent = '1';
        } else {
          countSpan.textContent = '0';
        }
      });

      // Click handler (toggle)
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const emoji = btn.dataset.emoji;
          const label = btn.dataset.label;
          const countSpan = btn.querySelector('.reaction-count');
          const currentlyActive = btn.classList.contains('active');

          let newActive;
          if (currentlyActive) {
            // Turn OFF
            newActive = false;
            btn.classList.remove('active');
            countSpan.textContent = '0';
          } else {
            // Turn ON
            newActive = true;
            btn.classList.add('active');
            countSpan.textContent = '1';
          }

          // Update state and save
          state[emoji] = newActive;
          saveState(state);

          // Small visual bump
          btn.classList.add('bump');
          setTimeout(() => btn.classList.remove('bump'), 150);

          console.log(
            `Reaction ${newActive ? 'added' : 'removed'}: ${emoji} (${label}). Active = ${newActive}`
          );
        });
      });
    });
  </script>
</body>
</html>
